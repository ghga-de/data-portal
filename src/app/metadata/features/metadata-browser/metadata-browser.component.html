<div class="grid grid-cols-12 grid-rows-none gap-5">
  <div class="col-span-9 col-start-4">
    @if (lastSearchQuery() !== '') {
      <mat-chip class="float-left mr-2"
        ><button class="align-middle" (click)="clearSearchQuery()">
          <mat-icon>Close</mat-icon></button
        >Keyword: {{ lastSearchQuery() }}</mat-chip
      >
    }
    @for (facet of searchResults().facets; track facet.key) {
      @if (lastSearchFilterFacets()[facet.key]) {
        @for (option of facet.options; track option.value) {
          @if (lastSearchFilterFacets()[facet.key].indexOf(option.value) !== -1) {
            <mat-chip class="float-left mr-2">
              <button
                class="align-middle"
                (click)="removeFacet(facet.key + '#' + option.value)"
              >
                <mat-icon>Close</mat-icon>
              </button>
              {{ facet.name }}: {{ option.value }}
            </mat-chip>
          }
        }
      }
    }
    <mat-chip class="float-right">Total Datasets: {{ searchResults().count }}</mat-chip>
  </div>
  <aside class="col-span-3">
    <div class="rounded-lg border p-3">
      <form [formGroup]="searchFormGroup" (keydown.enter)="$event.preventDefault()">
        <mat-form-field class="w-full">
          <input
            type="search"
            matInput
            placeholder="Search"
            name="searchTerm"
            [formControl]="searchFormControl"
            [(ngModel)]="searchTerm"
            (keyup.enter)="submit($event)"
          />
        </mat-form-field>
        @for (facet of searchResults().facets; track facet.key) {
          <div>
            {{ facet.name }}
            <ul class="mb-5 mt-1 rounded-lg border">
              @for (option of facet.options; track option.value) {
                <li>
                  <mat-checkbox
                    name="{{ facet.key }}#{{ option.value }}"
                    (change)="onFacetFilterChanged($event)"
                    [checked]="
                      facet.key + '#' + option.value | facetActivity: facetData
                    "
                    >{{ option.value }} ({{ option.count }})</mat-checkbox
                  >
                </li>
              }
            </ul>
          </div>
        }
        <div class="mt-8 grid grid-cols-2 gap-5">
          <button mat-stroked-button (click)="clear($event)">Clear</button>
          <button mat-flat-button (click)="submit($event)" type="submit">Filter</button>
        </div>
      </form>
    </div>
  </aside>

  <div class="col-span-9">
    <div class="mb-4 grid grid-cols-12 bg-primary px-6 py-2 text-white">
      <span class="col-span-2">Dataset ID</span><span class="col-span-10">Title</span>
    </div>
    @if (searchIsLoading()) {
      ... Loading ...
    } @else {
      <mat-accordion multi>
        @for (hit of searchResults().hits; track hit.id_) {
          <app-dataset-expansion-panel [hit]="hit" />
        }
      </mat-accordion>

      <mat-paginator
        (page)="handlePageEvent($event)"
        [length]="length()"
        [pageSize]="pageSize"
        [pageSizeOptions]="[5, 10, 25, 50]"
        aria-label="Select page"
      >
      </mat-paginator>
    }
  </div>
</div>
