<div class="overflow-x-auto p-4">
  <div class="justify-between md:flex">
    <header class="grow">
      <button
        mat-icon-button
        (click)="goBack()"
        data-umami-event="Access Grant Manager Back Link Clicked"
        aria-label="Go back to previous page"
        class="text-primary float-left mt-1 mr-4"
      >
        <mat-icon fontIcon="chevron_left"></mat-icon>
      </button>
      <h1>Study Details</h1>
    </header>
  </div>
  @if (studyDetails.error() || datasetsError() || id() === '') {
    <div class="min-w-72">
      <p class="text-base text-red-600">
        An error occurred while loading the study details. Please try again later.
      </p>
    </div>
  } @else if (studyDetails.isLoading() || datasetsLoading()) {
    <mat-spinner class="float-left" [diameter]="24"> </mat-spinner>
  } @else if (studyDetails.hasValue() && datasetsRequest.hasValue()) {
    @let study = studyDetails.value();
    <div class="min-w-72">
      @if (study.ega_accession) {
        <a
          appExtLink
          mat-stroked-button
          class="mb-4 ml-2 w-64 sm:float-right sm:mb-0"
          [href]="'https://ega-archive.org/studies/' + study.ega_accession"
        >
          Visit EGA Study Page
        </a>
      }
      @if (study.accession) {
        <a
          mat-raised-button
          class="button-quaternary mb-4 ml-2 w-64 sm:float-right sm:mb-0"
          [href]="metadataDownloadUrl()"
          download
          title="Download the study metadata as an Excel file"
          data-umami-event="Study Metadata Download Clicked"
          ><mat-icon fontIcon="download"></mat-icon>Download Metadata</a
        >
      }
      <h2 class="flex items-center text-2xl sm:inline-flex">
        <span
          class="bg-primary/15 text-primary inline-flex items-center rounded p-1 text-4xl"
          ><mat-icon inline fontIcon="book_2"></mat-icon></span
        >&nbsp; {{ study.title }}
      </h2>
      <p class="text-base"><strong>ID:</strong> {{ study.accession }}</p>
      @if (study.ega_accession) {
        <p class="text-base"><strong>EGA ID:</strong> {{ study.ega_accession }}</p>
      }
      <p class="text-base"><strong>Description:</strong> {{ study.description }}</p>
      <h3 class="flex items-center text-2xl sm:inline-flex">Datasets</h3>
      <div class="overflow-x-auto">
        @let columns = ['accession', 'title', 'ega'];
        <table
          mat-table
          [dataSource]="source"
          class="mat-elevation-z8 larger-mat-table-text"
        >
          <caption class="cdk-visually-hidden">
            Datasets belonging to study
            {{
              study.accession
            }}
          </caption>
          <ng-container matColumnDef="accession">
            <th mat-header-cell *matHeaderCellDef class="min-w-64">
              Dataset Accession
            </th>
            <td mat-cell *matCellDef="let ds">
              <a [routerLink]="'/dataset/' + ds.id_">{{ ds.id_ }}</a>
            </td>
          </ng-container>
          <ng-container matColumnDef="title">
            <th mat-header-cell *matHeaderCellDef class="min-w-md">Title</th>
            <td mat-cell *matCellDef="let ds">{{ ds.content.title }}</td>
          </ng-container>
          <ng-container matColumnDef="ega">
            <th mat-header-cell *matHeaderCellDef class="min-w-64">EGA Accession</th>
            <td mat-cell *matCellDef="let ds">{{ ds.content.ega_accession }}</td>
          </ng-container>
          <tr mat-header-row *matHeaderRowDef="columns"></tr>
          <tr mat-row *matRowDef="let row; columns: columns"></tr>
          <tr class="mat-row" *matNoDataRow>
            <td class="mat-cell p-4 text-base" colspan="3">
              No datasets were found for this study id.
            </td>
          </tr>
        </table>
      </div>
    </div>
  }
</div>
