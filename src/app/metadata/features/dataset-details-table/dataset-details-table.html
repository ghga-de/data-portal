<mat-expansion-panel>
  <mat-expansion-panel-header
    matTooltip="Download the full metadata to view all properties"
    matTooltipPosition="above"
    matTooltipShowDelay="500"
    matTooltipPositionAtOrigin="true"
    [matTooltipDisabled]="tooltipDisabled()"
    (mouseenter)="startHoverHeader()"
    (mouseleave)="endHoverHeader()"
    >{{ header() }}</mat-expansion-panel-header
  ><ng-template matExpansionPanelContent
    ><div class="overflow-auto">
      @if (data().length > 0 || filterValue()) {
        <mat-form-field appearance="outline" class="mt-2">
          <input
            matInput
            (keyup)="applyFilter($event)"
            placeholder="Filter by ..."
            #input
          /><mat-icon matPrefix fontIcon="filter_alt"></mat-icon>

          @if (filterValue()) {
            <button
              matSuffix
              mat-icon-button
              type="button"
              aria-label="Clear filter"
              (click)="clearFilter(input)"
            >
              <mat-icon fontIcon="close"></mat-icon>
            </button>
          }
        </mat-form-field>
      }
      <table
        mat-table
        class="bold-table-headers w-full min-w-[1280px]"
        [dataSource]="dataSource"
        matSort
      >
        <caption class="cdk-visually-hidden">
          {{ caption() }}
        </caption>
        @for (col of columns(); track col) {
          <ng-container [matColumnDef]="col.columnDef">
            <th mat-header-cell *matHeaderCellDef mat-sort-header [class]="col.class">
              {{ col.header }}
            </th>
            @if (col.columnDef === 'hash') {
              <td mat-cell *matCellDef="let item">
                <app-with-copy-button
                  [value]="item.file_information?.sha256_hash"
                  notifyMessage="The full hash has been copied to the clipboard"
                ></app-with-copy-button>
              </td>
            } @else {
              <td mat-cell *matCellDef="let item">
                {{
                  col.columnDef
                    | detailsDataRenderer: item : col.accessor : storageLabels()
                }}
              </td>
            }
          </ng-container>
        }

        <tr mat-header-row *matHeaderRowDef="displayCols()"></tr>
        <tr mat-row *matRowDef="let row; columns: displayCols()"></tr>
        <tr *matNoDataRow>
          <td class="mat-cell" [attr.colspan]="displayCols().length">
            @if (data().length === 0) {
              No data available.
            } @else {
              No results match “{{ filterValue() }}”.
            }
          </td>
        </tr>
      </table>

      @if (numItems() > 10) {
        <mat-paginator
          [pageSize]="defaultTablePageSize"
          [pageSizeOptions]="tablePageSizeOptions"
          showFirstLastButtons
          aria-label="Select page"
          class="sticky left-0"
        >
        </mat-paginator>
      }</div></ng-template
></mat-expansion-panel>
